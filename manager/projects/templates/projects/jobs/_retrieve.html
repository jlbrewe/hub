{% comment %}
A partial for displaying a job (with updating, via polling).

This is a partial (a) so that it can be included in pages for other
objects e.g. a page for a source, or a modal and (b) because it
is self-replacing (see below).

If the job is active then will have `hx-trigger="every 2s"` so that it's status,
results etc get updated. Uses `hx-swap="outerHTML"` so that the trigger
is removed when the job is inactive. Also includes the job as JSON data
in case the enclosing page want to use that data to trigger further events
(e.g. when the job is ended).
{% endcomment %}
<div {% if job.is_active %} hx-trigger="every 3s" hx-get="{% url 'api-projects-jobs-detail' job.project.id job.id %}"
     hx-template="projects/jobs/_retrieve.html" hx-swap="outerHTML" {% endif %}>
  <pre>
    is_active: {{ job.is_active }}
    status: {{ job.status }}
    method: {{ job.method }}
    params: {{ job.params }}
    log: {{ job.log }}
    result: {{ job.result }}
    error: {{ job.error }}
  </pre>

  <h2>Children</h2>
  <ol>
    {% for child in job.children.all %}
    <li>
      <a href="{% url 'ui-projects-jobs-retrieve' job.project.account_id job.project.id child.id %}">
        {{ child.method }} {{ child.params }} {{ child.status }}
      </a>
    </li>
    {% endfor %}
  </ol>
  {{ serializer.data|json_script:"job-data" }}
</div>
