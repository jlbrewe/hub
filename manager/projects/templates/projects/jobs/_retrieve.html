{% comment %}
A partial for displaying a job (with updating, via polling).

This is a partial (a) so that it can be included in pages for other
objects e.g. a page for a source, or a modal and (b) because it
is self-replacing (see below).

If the job is active then will have `hx-trigger="every 2s"` so that it's status,
results etc get updated. Uses `hx-swap="outerHTML"` so that the trigger
is removed when the job is inactive. Also includes the job as JSON data
in case the enclosing page want to use that data to trigger further events
(e.g. when the job is ended).
{% endcomment %}

{% load i18n humanize stencila %}

<div {% if job.is_active %} hx-trigger="every 3s" hx-get="{% url 'api-projects-jobs-detail' job.project.id job.id %}"
     hx-template="projects/jobs/_retrieve.html" hx-swap="outerHTML" {% endif %}>

  {% include "./_job_item.html" %}

  {% if job.result %}
  <hr />
  <h2 class="title is-4">Results</h2>
  <ul>
    {% for result in job.result %}
    <li>{{ result }}</li>
    {% endfor %}
  </ul>
  {% endif %}

  {% if job.children.all %}
  <hr />

  <h2 class="title is-4">Sub-Jobs</h2>
  <ol class="job-list">
    {% for child in job.children.all %}
    <li>
      {% include "./_job_item.html" with job=child is_list_item=True %}
    </li>
    {% endfor %}
  </ol>
  {% endif %}
  {{ serializer.data|json_script:"job-data" }}
</div>
