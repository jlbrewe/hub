{% load i18n humanize stencila %}

{% with account=project.account files_count=files|length %}
<table class="table is-fullwidth is-striped is-hoverable">
  <thead>
    <tr class="table-header">
      <th>
        {% trans "Type" %}
      </th>
      <th>
        {% trans "Path" %}
      </th>
      <th class="is-sr-only-mobile">
        {% trans "Last modified" %}
      </th>
      <th class="is-sr-only-mobile">
        {% trans "Size" %}
      </th>
      <th>
        <span class="is-sr-only">
          {% trans "Actions" %}
          <span>
      </th>
    </tr>
  </thead>
  <tbody>
    {% for file in files|slice:":100" %}
    <tr>
      <td class="source-table--file-type pr-0 is-vcentered">
        {% if file.is_directory %}
        <span class="has-tooltip-top has-tooltip-text-centered image-tooltip has-tooltip-bottom has-text-weight-bold"
              data-tooltip="Directory with {{file.count}} file{{ file.count|pluralize }}">
          <i class="ri-folder-line"></i>
        </span>
        {% else %}
        {% include './_format_icon.html' with mimetype=file.mimetype %}
        {% endif %}
      </td>
      <td class="is-vcentered table-icon-label has-text-black has-text-weight-bold">
        {% if file.is_directory %}
        <a href="{% url 'ui-projects-files-list' account.name project.name file.path %}"
           class="has-text-black has-text-link-hover has-tooltip-bottom has-tooltip-text-centered"
           data-tooltip="Directory with {{file.count}} file{{ file.count|pluralize }}">
          {{ file.name }}
        </a>
        {% else %}
        <a href="{% url 'ui-projects-files-retrieve' account.name project.name file.path %}"
           class="has-text-black has-text-link-hover">
          {{ file.name|default:file.path }}
        </a>
        {% if project.main and project.main == file.path %}
        <span class="tag is-primary is-light">{% trans 'Main' %}</span>
        {% endif %}
        {% endif %}
      </td>

      {% comment %}
      This section is for visualization of pipelines (sources and upstream files) and needs
      reconsideration and optimization so that it will work efficiently with a large number of files.

      {% flag 'ui-pipelines' %}
      <td class="is-vcentered">
        {% if is_root_files_list and not file.is_directory %}
        {% if source %}
        <a href="{% url 'ui-projects-sources-retrieve' account.name project.name source.address %}"
           class="has-text-black has-text-link-hover">
          {% include '../sources/_source_type_icon.html' with type=source.type_name tooltip=source.address %}
        </a>
        {% elif upstreams %}
        <span>
          {% for upstream in upstreams %}
          <a href="{% url 'ui-projects-files-retrieve' account.name project.name upstream.path %}"
             class="has-text-black has-text-link-hover">
            {% include '../files/_format_icon.html' with mimetype=upstream.mimetype tooltip=upstream.path %}
          </a>
          {% endfor %}
          {% endif %}
        </span>
        {% endif %}
      </td>
      {% endflag %}

      {% endcomment %}

      <td class="is-vcentered is-sr-only-mobile">
        {{ file.modified|naturaltime }}
      </td>
      <td class="is-vcentered is-sr-only-mobile">
        {{ file.size|format_bytes }}
      </td>
      <td class="has-text-right is-vcentered" style="weight: 1em;">
        {% if not file.is_directory %}
        {% include "./_actions_menu.html" %}
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if files_count > 100 %}
<p class="notification is-warning">
  {% trans 'The maximum number of files that can be list is currently 100.' %}
</p>
{% endif %}
{% endwith %}
