{% comment %}
A partial for displaying a snapshot (with updating, via polling).

This is a partial mainly because it is self-replacing (see below).

If the snapshot is active then will have `hx-trigger="every 2s"` so that it's status,
results etc get updated. Uses `hx-swap="outerHTML"` so that the trigger
is removed when the snapshot is inactive. Also includes the snapshot as JSON data
in case the enclosing page want to use that data to trigger further events
(e.g. when the snapshot is ended).
{% endcomment %}

{% load i18n humanize stencila %}

<div {% if snapshot.is_active %} hx-trigger="every 2s"
     hx-get="{% url 'api-projects-snapshots-detail' snapshot.project.id snapshot.id %}"
     hx-template="projects/snapshots/_retrieve.html" hx-swap="outerHTML" {% endif %}>

  {# Jobs associated with snapshot. Included here because status etc will change when the snapshot is_active #}
  <div class="level">
    <div class="level-left">
      {% with job=snapshot.job %}
      {% if job %}
      {% trans "Status:" %}&nbsp;
      <a href="{% url 'ui-projects-jobs-retrieve' snapshot.project.account.name snapshot.project.name job.id %}">
        {{ job.status }}
        {{ job.created|naturaltime }}
      </a>
      {% endif %}
      {% endwith %}
    </div>
  </div>

  {# List of files pulled from the snapshot #}
  {% with files=snapshot.files.all %}
  {% if files %}
  {% include "../files/_list.html" %}
  {% else %}

  <p class="is-4 has-text-grey">
    {% trans 'No Jobs yet' %}
  </p>
  {% endif %}
  {% endwith %}
</div>
