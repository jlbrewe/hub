/**
 * Script to generate Python files from Javascript dependencies.
 *
 * The generated files should be committed so that Python developers,
 * and deployments don't need to run `npm install` first.
 */

const fs = require("fs");
const path = require("path");

thema();

/**
 * Generate `manager/themes.py` with the version of
 * Thema to use and the names of themes available.
 */
function thema() {
  const json = fs.readFileSync(
    path.join(
      require.resolve("@stencila/thema"),
      "..",
      "..",
      "..",
      "package.json"
    ),
    "utf8"
  )
  const version = JSON.parse(json).version

  const themes = require("@stencila/thema").themes

  fs.writeFileSync(
    path.join(__dirname, "manager", "themes.py"),
    `# Generated by ${path.basename(
      __filename
    )}. Commit this file, but do not edit it.

from manager.helpers import EnumChoice

# The version of Thema to use
version = "${version}"


class Themes(EnumChoice):
    """The list of Thema themes."""

${Object.keys(themes).map(theme => `    ${theme} = "${theme}"`).join('\n')}
`
  )
}
